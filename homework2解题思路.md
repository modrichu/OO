# 第二次作业解题思路

<font size=5> Class：</font>

MainDP , CheckPoly , Term , Factor , Derivation , Simp

主函数入口：

读入字符串，首先实例化CheckPoly对字符串的合法性进行检查

## 检查合法性

check方法首先调用PreCheck方法进行除去空格和合并符号前的预检查

预检查使用列举的方法对非法情况进行罗列，出现这样的情况（.find()）则直接返回false

罗列的情况有：

1、空格带来的非法：

​	数字之间有空格

​	在非第一个因子和指数上的数字如果符号和数字分离则非法

​	三角函数的保留字内有空格

2、符号个数带来的非法：

​	四个以上符号一定是错误的

​	三符号：

​		如果三符号后面不是数字则错误

​		如果出现三符号不是在项的第一个因子则错误（即前面有*）

​		三符号是第一个因子，且后面是数字，但如果最后一个符号和数字之间有空格也非法

​	双符号：

​		不是第一个因子，非法

​		是第一个因子，只要出现双符号都可以解释：如果是第一项，第一个符号是项前面的符号，第二个符号是因子省略，可以解释；如果不是第一项，第一个符号是运算连接符，第二个符号是因子省略

在预检查合法后，即可去除表达式内所有的\t和\<space>，并且还可以合并所有的三符号，双符号

**判断空串**：处理后，可能出现空串的情况，因此需要判断一下是否为空串

### 分割字符串

然后在运算连接符前加空格

循环遍历整个字符串，第一个字符略过，如果字符是+或-，并且前一个字符不是^和*，证明他不是指数和因子上的数字自带的符号，而且由于已经合并符号，因此第一个因子是数字的话，它的符号也可以当做运算连接符

以空格为界限进行字符串的分割，将字符串分割成不同的项

### 检查每一项合法性

实例化Term类，在构造函数类自动进行项的分割以及合并同类项

在分割项前，进行处理，由于运算符后面跟的可能是x或者三角函数，但是Factor中并没有关于他们系数的属性，默认他们的系数为1，而运算符如果是'-'，将可能被省略，因此我们采用这样的方法：如果有一个字符以上且第一项是符号而且第二项不是数字，那么就在符号后面补上1*，强行增加一个常数项，通过这样的方法来保证'-'不被忽略

特判最后一个字符是*的话输出格式错误

### 分割项

以“*”为分界线将项分割成多个因子

实例化Factor，自动进行一些操作

### 对因子操作

首先对因子进行分类，分别用4个正则表达式对因子进行匹配

首先是常数项，如果匹配  符号？数字+，就代表是常数项

如果匹配x(\\^[+-]?[0-9]+)?，就代表是幂函数项

如果匹配sin\\(x\\)(\\^[+-]?[0-9]+)?，就代表是sinx项

如果匹配cos\\(x\\)(\\^[+-]?[0-9]+)?，就代表是cosx项

分类结束后

如果是常数项，读取系数，指数都设成0

如果不是常数项，读取指数，系数都设为1，如果读取不到指数，指数也是1

### 合并同类因子

对一项中的所有因子进行遍历，如果是一种类型，就合并，如果kind=-1，不属于任何类型，就返回输出错误



## 求导

遍历整个Term数组，即遍历所有的项，每一项只有四个因子，常数可以不参与求导，对其他三项复合求导

1、幂函数求导，sinx和cosx不求导：常数项=常数项*幂函数的指数；幂函数指数-1；其他不变

2、sinx求导，其他不求导：常数项=常数项*sinx的指数；sinx指数-1；cosx指数+1

3、cosx求导，其他不求导：常数项=常数项*cosx的指数；cosx指数-1；sinx指数+1；如果cosx本来指数不是0的话将常数项取反

## 化简合并

遍历Term数组，如果合并过就标记false，没合并就标记true，如果幂函数、sinx、cosx指数都相同，就将常数项相加，标记false

合并：将三符号、双符号相连的合并成一个符号

## 输出

重写toString方法

遍历数组，对于有效项，如果相应的指数/系数不是0就输出对应项，并在末尾输出+

将^1  1*  开头的+  结尾的+-  都去除（常数项只可能作为第一个因子，因此*1没有必要）

符号再次合并

如果输出空串，就输出0





























